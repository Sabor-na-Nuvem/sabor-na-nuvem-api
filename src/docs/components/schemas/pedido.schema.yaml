components:
  schemas:

    # --- NOVO: Input de Endereço Reutilizável ---
    EnderecoInput:
      type: object
      required: [cep, logradouro, numero, bairro, cidade, estado]
      properties:
        cep: { type: string, example: "70000000" }
        logradouro: { type: string, example: "Av. Paulista" }
        numero: { type: string, example: "1000" }
        complemento: { type: string, nullable: true }
        bairro: { type: string, example: "Bela Vista" }
        cidade: { type: string, example: "São Paulo" }
        estado: { type: string, example: "SP" }
        pontoReferencia: { type: string, nullable: true }
        latitude: { type: number, format: float, nullable: true }
        longitude: { type: number, format: float, nullable: true }

    # --- Schemas de Resposta ---
    ItemPedidoModificadorDetalhado:
      type: object
      properties:
        valorAdicionalCobrado: { type: number, format: float }
        modificador:
          type: object
          properties:
            personalizavelId: { type: integer }
            nome: { type: string }
            ordemVisualizacao: { type: integer, nullable: true }

    ItemPedidoDetalhado:
      type: object
      properties:
        id: { type: integer }
        produtoId: { type: integer }
        qtdProduto: { type: integer }
        valorUnitarioProduto: { type: number, format: float }
        produto:
          type: object
          properties:
            nome: { type: string }
            imagemUrl: { type: string, format: url, nullable: true }
            categoria:
              type: object
              properties:
                nome: { type: string }
        personalizacao:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              nome: { type: string }
        modificadoresSelecionados:
          type: array
          items:
            $ref: '#/components/schemas/ItemPedidoModificadorDetalhado'

    PedidoDetalhado:
      type: object
      properties:
        id: { type: integer }
        clienteId: { type: string, format: uuid, nullable: true }
        lojaId: { type: integer }
        dataHora: { type: string, format: date-time }
        valorBase: { type: number, format: float }
        valorCobrado: { type: number, format: float }
        cupomUsadoId: { type: integer, nullable: true }
        tipo: { $ref: '#/components/schemas/TipoPedido' }
        observacoes: { type: string, nullable: true }
        status: { $ref: '#/components/schemas/StatusPedido' }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        cupom:
          type: object
          nullable: true
          properties:
            codCupom: { type: string }
        loja:
          type: object
          properties:
            nome: { type: string }
        cliente:
          type: object
          nullable: true
          properties:
            nome: { type: string }
        endereco:
          $ref: '#/components/schemas/EnderecoInput'
          nullable: true
        itensNoPedido:
          type: array
          items:
            $ref: '#/components/schemas/ItemPedidoDetalhado'

    Paginacao:
      type: object
      properties:
        totalItens: { type: integer }
        itensPorPagina: { type: integer }
        paginaAtual: { type: integer }
        totalPaginas: { type: integer }

    PedidoParaLista:
      type: object
      properties:
        id: { type: integer }
        clienteId: { type: string, format: uuid, nullable: true }
        lojaId: { type: integer }
        dataHora: { type: string, format: date-time }
        valorCobrado: { type: number, format: float }
        tipo: { $ref: '#/components/schemas/TipoPedido' }
        status: { $ref: '#/components/schemas/StatusPedido' }
        createdAt: { type: string, format: date-time }
        loja:
          type: object
          nullable: true
          properties:
            nome: { type: string }
        cliente:
          type: object
          nullable: true
          properties:
            nome: { type: string }

    ListaPedidosResponse:
      type: object
      properties:
        pedidos:
          type: array
          items:
            $ref: '#/components/schemas/PedidoParaLista'
        paginacao:
          $ref: '#/components/schemas/Paginacao'

    # --- Schemas de Input (Requisição) ---
    ItemCarrinhoMockadoInput:
      type: object
      required: [produtoId, qtdProduto, valorUnitarioProduto]
      properties:
        produtoId: { type: integer }
        qtdProduto: { type: integer, minimum: 1 }
        valorUnitarioProduto: { type: number, format: float }
        modificadoresSelecionados:
          type: array
          items:
            type: object
            required: [modificadorId, valorAdicionalCobrado]
            properties:
              modificadorId: { type: integer }
              valorAdicionalCobrado: { type: number, format: float }

    CarrinhoMockadoInput:
      type: object
      required: [lojaId, tipo, itensNoCarrinho]
      properties:
        lojaId: { type: integer }
        tipo: { $ref: '#/components/schemas/TipoPedido' }
        itensNoCarrinho:
          type: array
          items:
            $ref: '#/components/schemas/ItemCarrinhoMockadoInput'
        enderecoEntrega:
          $ref: '#/components/schemas/EnderecoInput'
          nullable: true

    CriarPedidoInput:
      type: object
      properties:
        codCupom: { type: string, nullable: true }
        observacoes: { type: string, nullable: true }
        carrinho:
          $ref: '#/components/schemas/CarrinhoMockadoInput'
        enderecoEntrega:
          $ref: '#/components/schemas/EnderecoInput'
          nullable: true

    AtualizarStatusPedidoInput:
      type: object
      required: [status]
      properties:
        status:
          $ref: '#/components/schemas/StatusPedido'
      example:
        status: 'EM_PREPARO'
